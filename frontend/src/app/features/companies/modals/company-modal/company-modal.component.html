<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg w-full max-w-lg p-6">
    <h2 class="text-xl font-semibold mb-4">
        @if (company()) {
            Edit Company
        } @else {
            Create Company
        }
    </h2>

    <div class="space-y-3">
        <div>
            <label class="text-sm font-medium">
            Name <span class="text-red-500">*</span>
            </label>
            <input
                class="w-full border p-2 rounded"
                placeholder="Name"
                [class.border-red-500]="isNameInvalid()"
                [value]="name()"
                (input)="name.set($any($event.target).value)"
                (blur)="touchedName.set(true)" />

            @if (isNameInvalid()) {
                <p class="text-xs text-red-500 mt-1">campo obrigatório</p>
            }
        </div>

        <div>
            <label class="text-sm font-medium">
            CNPJ <span class="text-red-500">*</span>
            </label>

            <input
                class="w-full border p-2 rounded"
                maxlength="18"
                placeholder="CNPJ"
                [value]="maskedCnpj()"
                (input)="onCnpjInput($event)"
                (blur)="touchedCnpj.set(true)"
                [readonly]="!!company()"
                [class.bg-gray-100]="!!company()"
                [class.cursor-not-allowed]="!!company()"
                [class.border-red-500]="touchedCnpj() && !isCnpjValid()"/>

            @if (isCnpjEmpty()) {
                <p class="text-xs text-red-500 mt-1">campo obrigatório</p>
            }
            @else if (touchedCnpj() && !isCnpjValid()) {
                <p class="text-xs text-red-600 mt-1">CNPJ inválido</p>
            }
        </div>

        <div>
            <label class="text-sm font-medium">
            CEP <span class="text-red-500">*</span>
            </label>

            <input
                class="w-full border p-2 rounded"
                [class.border-red-500]="isCepInvalid()"
                placeholder="CEP"
                [value]="cep()"
                (input)="onCepInput($event)"
                (blur)="touchedCep.set(true)"/>

            @if (isCepInvalid()) {
                <p class="text-xs text-red-500 mt-1">
                    {{ cepNotFound() ? 'CEP inválido' : 'campo obrigatório' }}
                </p>
            }
        </div>

        <div>
            <label class="text-sm font-medium">
            UF
            </label>
            <input
                class="w-full border p-2 rounded bg-gray-100 cursor-not-allowed"
                placeholder="UF"
                [value]="uf()"
                readonly/>
        </div>
    </div>

    <div class="mt-4 relative">
        <label class="block font-medium mb-1">Suppliers</label>

        <div id="suppliers-container" >
            <button
                type="button"
                class="w-full border rounded p-2 flex flex-wrap gap-2 min-h-[42px] items-center"
                (click)="toggleSuppliers()">
    
                @if (selectedSupplierIds().length === 0) {
                <span class="text-gray-400">Select suppliers</span>
                }
    
                @for (id of selectedSupplierIds(); track id) {
                <span
                    class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">
                    {{ supplierName(id) }}
                </span>
                }
            </button>
    
            @if (isSuppliersOpen()) {
                <div class="absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-42 overflow-y-auto">
    
                @for (supplier of suppliers(); track supplier.id) {
                    <div
                    class="flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-gray-100"
                    (click)="toggleSupplier(supplier.id)">
    
                    <span>{{ supplier.name }}</span>
    
                    @if (selectedSupplierIds().includes(supplier.id)) {
                        <span class="text-green-600 font-bold">✓</span>
                    }
                    </div>
                }
                </div>
            }
        </div>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button class="px-4 py-2 border rounded cursor-pointer hover:bg-gray-300"
              (click)="cancel()">
        Cancel
      </button>

      <button 
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
        [class.bg-blue-600]="isFormValid()"
        [class.bg-blue-300]="!isFormValid()"
        [disabled]="!isFormValid()"
        (click)="save()">
            Save
      </button>
    </div>
  </div>
</div>